<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>LWS Authentication Suite: OpenID Connect</title>
    <script src="https://www.w3.org/Tools/respec/respec-w3c" class="remove"></script>
    <link rel="stylesheet" href="local.css"/>
    <script class='remove'>
      // See https://respec.org/docs/ for how to configure ReSpec
      var respecConfig = {
        specStatus: "ED",
        shortName: "lws-authn-openid",
        editors: [{
          name: "Jesse Wright"
        }],
        authors: [{
          name: "Aaron Coburn"
        }],
        github: "w3c/lws-protocol",
        xref: ["web-platform"],
        group: "lws",
      };
    </script>
  </head>
  <body>
    <section id="abstract">
      <p>
        This document defines an OpenID Connect-based authentication suite for the Linked Web Storage (LWS) protocol, enabling LWS applications to integrate with OpenID providers.
      </p>
    </section>
    <section id="sotd">
      <p>
        This is an unofficial proposal.
      </p>
    </section>

    <section id="introduction">
      <h2>Introduction</h2>
      <p>
        OpenID Connect is a widely used mechanism for web-based authentication. This authentication suite describes how an OpenID provider can be used with Linked Web Storage-conforming applications.
      </p>
    </section>
    <section id="conformance"></section>

    <section id="terminology">
      <h2>Terminology</h2>

      <p>
        The terms "authorization server" and "client" are defined by The OAuth 2.0 Authorization Framework [[!RFC6749]].
      </p>

      <p>
        The terms "OpenID provider", "id token", "end-user", and "issuer" are defined by OpenID Connect Core 1.0 [[!OPENID-CONNECT-CORE]].
      </p>

      <p>
        The term "openid connect discovery" is defined by OpenID Connect Discovery 1.0 [[!OPENID-CONNECT-DISCOVERY]].
      </p>

      <p>
        The term "controlled identifier document" is defined by W3C Controlled Identifiers 1.0 [[!CID-1.0]].
      </p>

      <p>
        The terms "JSON Web Token (JWT)" and "claim" are defined by JSON Web Token [[!RFC7519]].
      </p>

      <p>
        The term "JSON Web Key (JWK)" is defined by JSON Web Key [[!RFC7517]].
      </p>

      <p>
        The terms "authentication credential" and "authentication suite" are defined by Linked Web Storage Protocol [[!LWS-PROTOCOL]]
      </p>
    </section>

    <section id="serialization">
      <h2>Authentication Credential Serialization</h2>

      <p>
        OpenID Connect defines a protocol for producing signed ID Tokens, which are used to describe an end-user.
        An ID Token is serialized as a signed JSON Web Token (JWT). In order to use an ID Token as an LWS authentication credential,
        the following additional requirements apply.
      </p>

      <ul>
        <li>
          The ID Token MUST NOT use "none" as the signing algorithm.
        </li>

        <li>
          The ID Token MUST use the <code>sub</code> (subject) claim for the LWS subject identifier.
        </li>

        <li>
          The ID Token MUST use the <code>iss</code> (issuer) claim for the LWS issuer identifier.
        </li>

        <li>
          The ID Token MUST use the <code>azp</code> (authorized party) claim for the LWS client identifier.
        </li>

        <li>
          Any audience restriction in the ID Token MUST use the <code>aud</code> (audience) claim.
          The <code>aud</code> claim SHOULD include the client identifier and any additional target
          audience such as an authorization server.
        </li>
      </ul>

      <p>
        An example ID Token that is also an LWS authentication credential is included below.
      </p>

      <pre id="example-id-token" class="example">
{
  "typ": "JWT",
  "kid": "12dbe73a",
  "kty": "EC",
  "alg": "ES256",
  "crv": "P-256"
}
.
{
  "sub": "https://id.example/end-user",
  "iss": "https://openid.example",
  "azp": "https://client.example/17da1b",
  "aud": ["https://client.example/17da1b", "https://as.example"],
  "iat": 1761313600,
  "exp": 1761313900
}
.
signature
      </pre>
    </section>

    <section id="validation">
      <h2>Authentication Credential Validation</h2>

      <p>
        For an ID Token to validate as an LWS authentication credential,
        there must be a trust relationship between the verifier and the issuing party.
      </p>

      <p>
        In the absence of a pre-existing trust relationship, the validator MUST dereference the <code>sub</code> (subject) claim in the authentication credential.
        The resulting resource MUST be formatted as a valid controlled identifier document [[!CID-1.0]] with an <code>id</code> value equal to the subject identifier.
      </p>

      <p>
        The verifier MUST use the subject's controlled identifier document to locate a service object whose <code>serviceEndpoint</code> value
        is equal to the value of the <code>iss</code> claim from the authentication credential, and whose <code>type</code> value is equal to <code>https://www.w3.org/ns/lws#OpenIdProvider</code>.
        The verifier MUST perform OpenID Connect Discovery to locate the public portion of the JSON Web Key (JWK) used to sign the authentication credential.
        The JWT MUST be validated as described by OpenID Connect Core Section 3.1.3.7 [[!OPENID-CONNECT-CORE]].
      </p>

      <p>
        An example Controlled Identifier Document for an agent using OpenID Connect is included below.
      </p>

      <pre id="example-cid" class="example">
{
    "@context": [
        "https://www.w3.org/ns/cid/v1"
    ],
    "id": "https://id.example/end-user",
    "service": [{
        "type": "https://www.w3.org/ns/lws#OpenIdProvider",
        "serviceEndpoint": "https://openid.example"
    }]
}
      </pre>
    </section>

    <section id="token-type">
      <h2>Token Type Identifier</h2>

      <p>
        An ID Token used as an authentication credential MUST use the <code>urn:ietf:params:oauth:token-type:id_token</code> URI when interacting with an authorization server.
      </p>

    </section>

    <section id="security-considerations" class="informative">
      <h2>Security Considerations</h2>

      <p>
        All security considerations described in "Best Current Practice for OAuth 2.0 Security" [[RFC9700]] and "OpenID Connect Core 1.0" Section 16 [[OPENID-CONNECT-CORE]] apply to this specification.
      </p>

      <p>
        An OpenID provider should support a mechanism to restrict the audience of an authentication credential to a limited set of entities, including an authorization server.
        One mechanism for achieving this is to use Resource Indicators for OAuth 2.0 [[RFC8707]].
        A client in possession of an authentication credential with no audience restrictions should exchange this token for an equivalent audience-restricted token by using, for example, OAuth 2.0 Token Exchange [[RFC8693]].
      </p>

      <p>
        An OpenID provider should provide support for "OAuth 2.0 Authorization Server Issuer Identification" [[RFC9207]] by including an <code>iss</code> parameter in the authorization response of an OAuth flow.
      </p>

      <p>
        An OpenID provider should provide support for end-user logout, such as RP-Initiated Logout 1.0.
      </p>

      <p>
        The issuer of an authentication credential is responsible for validating the client identifier.
        The issuer may use mechanisms such as OAuth Client Metadata Document, OAuth 2.0 Client Id Prefix, or OpenID Federation.
      </p>

      <p>
        It is recommended that OpenID providers support WebAuthn [[WEBAUTHN-3]] as a mechanism for authenticating users.
      </p>
    </section>
  </body>
</html>
